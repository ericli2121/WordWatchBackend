# YouTube Extractor API

A Node.js API server for extracting YouTube subtitles and video details with support for automatic translated subtitles.

## Features

- Extract YouTube video subtitles/captions
- Get video details (title, description, etc.)
- Support for multiple languages including automatic translations
- Dual extraction methods with automatic fallback
- RESTful API endpoints
- Error handling and validation
- CORS enabled

## Important Note

This server now uses YouTube's InnerTube API v1 (`https://www.youtube.com/youtubei/v1`) as the primary method for extracting subtitles, with an automatic fallback chain: `InnerTube API v1` → `youtube-caption-extractor` → `@distube/ytdl-core`. This provides the best reliability and support for automatic translated subtitles by using YouTube's internal API directly.

## Installation

1. Clone or download this project
2. Install dependencies:
   ```bash
   npm install
   ```

## Usage

### Start the server

```bash
# Development mode (with auto-restart)
npm run dev

# Production mode
npm start
```

The server will start on `http://localhost:3000` by default.

### API Endpoints

#### Extract Subtitles and Video Details

**GET** `/api/extract`

**Parameters:**
- `videoID` (required): YouTube video ID
- `lang` (optional): Language code (e.g., 'en', 'es', 'fr')
- `method` (optional): Extraction method ('ytdl' for ytdl-core, 'caption-extractor' for youtube-caption-extractor, or omit for auto-fallback)

**Examples:**
```
# Auto-fallback (tries InnerTube API v1 first, then caption-extractor, then ytdl-core)
GET http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en

# Get Spanish subtitles (will auto-translate if not available natively)
GET http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=es

# Get French subtitles (will auto-translate if not available natively)
GET http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=fr

# Force ytdl-core method
GET http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en&method=ytdl

# Force youtube-caption-extractor method
GET http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en&method=caption-extractor
```

**Response (InnerTube API v1 method):**
```json
{
  "success": true,
  "method": "InnerTube API v1",
  "data": {
    "subtitles": [
      {
        "start": "0.0",
        "dur": "2.5",
        "text": "Never gonna give you up"
      }
    ],
    "language": "en",
    "isAutoTranslated": false,
    "availableLanguages": [
      {
        "code": "en",
        "name": "English",
        "isAutoGenerated": false,
        "isAutoTranslated": false
      },
      {
        "code": "es",
        "name": "Spanish (Auto-translated)",
        "isAutoGenerated": false,
        "isAutoTranslated": true
      }
    ]
  }
}
```

**Response (youtube-caption-extractor method):**
```json
{
  "success": true,
  "method": "youtube-caption-extractor",
  "data": {
    "subtitles": [
      {
        "start": "0.0",
        "dur": "2.5",
        "text": "Never gonna give you up"
      }
    ],
    "videoDetails": {
      "title": "Rick Astley - Never Gonna Give You Up",
      "description": "...",
      "duration": "3:32"
    }
  }
}
```

**Response (ytdl-core method):**
```json
{
  "success": true,
  "method": "ytdl-core",
  "data": {
    "subtitles": [
      {
        "start": "0.0",
        "dur": "2.5",
        "text": "Never gonna give you up"
      }
    ],
    "availableLanguages": [
      {
        "code": "en",
        "name": "English"
      },
      {
        "code": "es",
        "name": "Spanish"
      }
    ]
  }
}
```

#### Health Check

**GET** `/health`

Returns server status.

#### Root Endpoint

**GET** `/`

Returns API information and available endpoints.

## Example Usage

### Using curl

```bash
# Extract subtitles for a video (auto-fallback)
curl "http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en"

# Extract subtitles using ytdl-core (better for automatic translations)
curl "http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en&method=ytdl"

# Extract subtitles using youtube-caption-extractor
curl "http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en&method=caption-extractor"

# Extract Spanish subtitles using ytdl-core
curl "http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=es&method=ytdl"
```

### Using JavaScript (fetch)

```javascript
// Auto-fallback method (tries InnerTube API v1 first)
const response = await fetch('http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en');
const data = await response.json();
console.log(data);

// Force ytdl-core method for better automatic translation support
const response2 = await fetch('http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=es&method=ytdl');
const data2 = await response2.json();
console.log(data2);

// Force youtube-caption-extractor method
const response3 = await fetch('http://localhost:3000/api/extract?videoID=dQw4w9WgXcQ&lang=en&method=caption-extractor');
const data3 = await response3.json();
console.log(data3);
```

## Error Handling

The API returns appropriate HTTP status codes and error messages:

- `400`: Bad Request (missing required parameters)
- `500`: Internal Server Error (extraction failed)

Example error response:
```json
{
  "success": false,
  "error": "videoID parameter is required"
}
```

## Environment Variables

- `PORT`: Server port (default: 3000)

## Dependencies

- `express`: Web framework
- `youtube-caption-extractor`: Secondary YouTube subtitle extraction (includes video details)
- `@distube/ytdl-core`: Fallback YouTube subtitle extraction (shows available languages)
- `xml2js`: XML parsing for subtitle data
- `cors`: Cross-origin resource sharing
- `nodemon`: Development auto-restart (dev dependency)

## Extraction Methods

### Method 1: YouTube InnerTube API v1 (Default)
- **Pros**: Direct access to YouTube's internal API, best support for automatic translated subtitles, shows available languages, no API key required, automatically translates to requested language if not available
- **Cons**: Uses unofficial API, may break if YouTube changes their API
- **Use case**: When you need the most reliable subtitle extraction with automatic language translation support

### Method 2: youtube-caption-extractor (Fallback)
- **Pros**: Simple API, includes video details
- **Cons**: Limited support for automatic translated subtitles
- **Use case**: When you need video details along with subtitles

### Method 3: @distube/ytdl-core (Final Fallback)
- **Pros**: Shows available languages, can extract video metadata
- **Cons**: More complex, may have limitations with some videos
- **Use case**: When you need to see available languages or when other methods fail

### Auto-Fallback Behavior
By default, the server tries YouTube InnerTube API v1 first. If it fails, it automatically falls back to `youtube-caption-extractor`, and then to `@distube/ytdl-core`. You can force a specific method using the `method` parameter.

## License

MIT
